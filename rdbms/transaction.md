# Transaction(트랜잭션)

- 트랜잭션은 은행 ATM이나 데이터베이스 등의 시스템에서 사용되는 더 이상 쪼갤 수 없는 업무 처리의 최소 단위이다.
- 거래내역, Tx

## 특징(ACID)

- Atomicity(원자성)
    - 하나의 트랜잭션은 더 이상 작게 쪼갤 수 없는 최소한의 업무 단위이다
    - All or Nothing
        - 트랜잭션이 데이터베이스에 모두 반영되던지, 아니면 전혀 반영되지 않아야 하며
        - 작업이 부분적으로 실행되거나 중단되지 않는 것을 보장
        - 중간 상태가 없음
    - why?
        - 트랜잭션은 사람이 설계한 논리적인 작업 단위이기 때문에 일처리가 작업 단위 별로 이루어져야 사람이 다루는데 무리가 없다. 만약 트랜잭션 단위로 데이터가 처리되지
          않는다면, 설계한 사람은 데이터 처리 시스템을 이해하기 힘들 뿐만 아니라, 오작동 했을 시 원인을 찾기가 매우 힘들어진다.
- Consistency(일관성)
    - 트랜잭션이 완료된 결괏값이 일관적인 DB 상태를 유지하는 것
    - 트랜잭션 수행 전/후에 데이터 모델의 모든 제약 조건(기본 키, 외래 키, 도메인, 도메인 제약조건 등)을 만족하는 것을 통해 보장
    - A에서 B로 돈을 이체할 때 A와 B 계좌의 돈의 총합이 같아야 한다는 사항과 같은 비명시적인 일관성 조건도 보장해야함
    - why?
        - 트랜잭션이 진행되는 동안 데이터베이스가 변경되더라도 업데이트된 데이터베이스로 트랜잭션이 진행되는 것이 아니라, 처음 트랜잭션을 진행하기 위해 참조한 데이터베이스로
          진행된다. 이렇게 함으로써 각 사용자가 일관성 있는 데이터를 볼 수 있는 것이다. 트랜잭션 수행 전후의 데이터베이스 상태는 각각 일관성이 보장되는 서로 다른
          상태가 된다.
        - A에서 B로 돈을 이체할 때 A와 B 계좌의 돈의 총합이 같아야 한다
- [Isolation(고립성)](../rdbms/transaction_isolation_level.md)
    - 하나의 트랜잭션 수행시 다른 트랜잭션의 작업이 끼어들지 못하도록 보장
    - 트랜잭션 끼리는 서로를 간섭할 수 없다
        - 트랜잭션이 실행하는 도중에 변경한 데이터는 이 트랜잭션이 완료될 때까지 다른 트랜잭션이 참조하지 못하게 하는 특성
    - 여러 트랜잭션이 동시에 접근하는 데이터에 대한 제어가 필요
    - 격리성이라고도 한다
    - why?
        - 동시 접근에 따른 이상 현상을 해결해야함
            - DW(Dirty Writes)
            - DR(Dirty Reads)
            - NRR(Non-Repeatable Reads)
            - PR(Phantom Reads)
- Durability(지속성)
    - 트랜잭션이 정상적으로 종료된 다음에는 영구적으로 데이터베이스에 작업의 결과가 저장
    - 정상적으로 완료 혹은 부분 완료된 데이터는 DBMS가 책임지고 데이터베이스에 기록하는 성질
        - 트랜잭션의 성공 결과 값은 장애 발생 후에도 변함없이 보관되어야 한다는 것으로 트랜잭션이 정상적으로 완료된 경우에는 버퍼의 내용을 하드디스크(데이터베이스)에
          확실히 기록해야 하며, 부분 완료(Partial Commit)된 경우에는 작업을 취소(Aborted)하여야 한다
    - 영속성이라고 표현하기도 한다
    - why?
        - 트랜잭션이 정상적으로 종료된 다음에는 영구적으로 데이터베이스에 작업의 결과가 저장되어야 함

## 참고

- [http://wiki.hash.kr/index.php/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98](http://wiki.hash.kr/index.php/%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98)
- [https://dataonair.or.kr/db-tech-reference/d-lounge/expert-column/?mod=document&uid=54384](https://dataonair.or.kr/db-tech-reference/d-lounge/expert-column/?mod=document&uid=54384) 